{% extends "base.html" %} 
{% block title %}PyCon Togo 2025 - Schedule {% endblock %} 
{% block style %}
<script src="../static/js/main.js" defer></script>
<script src="../static/js/coming-soon.js" defer></script>
<script src="../static/js/schedule.js" defer></script>
<link rel="stylesheet" href="../static/css/coming-soon.css" />
<link rel="stylesheet" href="../static/css/schedule.css" />
{% endblock %} 

{% block content %}
<section class="page-content" id="program">
  <div class="schedule-container">
    <!-- Header -->
    <div class="schedule-header">
      <h1>Programme PyCon Togo 2025</h1>
      <p>What you see is just a print</p>
    </div>

    <!-- Schedule Grid -->
    <div class="schedule-grid">
      {% for session in schedule %}
        <div class="session-card {{ session.type }}" data-session-id="{{ session.id }}">
          <div class="time-ribbon {% if session.type == 'break' %}break-ribbon{% endif %}">
            <span class="time-text">{{ session.start_time }}<br />–<br />{{ session.end_time }}</span>
          </div>
          <div class="session-content">
            <h3>{{ session.title }}</h3>
            {% if session.subtitle %}
              <div class="session-subtitle">{{ session.subtitle }}</div>
            {% endif %}
            {% if session.description_short %}
              <div class="session-description" title="{{ session.description_full }}">
                {{ session.description_short }}
              </div>
            {% endif %}
            {% if session.speakers and session.participant_count > 0 %}
              <div class="avatars-container">
                <div class="avatars">
                  {# CORRECTION: Gestion différente pour les panels et les sessions normales #}
                  {% if session.type == 'panel' and session.panel_avatars %}
                    {# Pour les panels : afficher jusqu'à 3 avatars différents #}
                    {% for avatar_url in session.panel_avatars[:3] %}
                      <div class="avatar avatar-{{ loop.index }}">
                        {% if avatar_url %}
                          <img
                            class="avatar avatar-{{ loop.index }}"
                            src="{{ avatar_url }}"
                            alt="Paneliste {{ loop.index }}"
                          />
                        {% else %}
                          <div class="avatar avatar-{{ loop.index }}" style="background: #004225; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;">
                            {{ session.speakers[loop.index0][:1] if session.speakers[loop.index0] else '?' }}
                          </div>
                        {% endif %}
                      </div>
                    {% endfor %}
                    {% if session.panel_avatars|length > 3 %}
                      <div class="avatar avatar-more" style="background: #004225; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.7rem;">
                        +{{ session.panel_avatars|length - 3 }}
                      </div>
                    {% endif %}
                  {% else %}
                    {# Pour les sessions normales : afficher un seul avatar #}
                    {% for speaker in session.speakers[:1] %}
                      <div class="avatar avatar-{{ loop.index }}">
                        {% set avatar_url = none %}
                        
                        {# CORRECTION: Nouvelle logique pour récupérer l'avatar #}
                        {# 1. Vérifier si on a un avatar_url direct dans la session #}
                        {% if session.avatar_url %}
                          {% set avatar_url = session.avatar_url %}
                        {# 2. Sinon, vérifier dans les talks #}
                        {% elif session.talks and session.talks[0].avatar_url %}
                          {% set avatar_url = session.talks[0].avatar_url %}
                        {% endif %}
                        
                        {% if avatar_url %}
                          <img
                            class="avatar avatar-{{ loop.index }}"
                            src="{{ avatar_url }}"
                            alt="{{ speaker }}"
                          />
                        {% else %}
                          <!-- Fallback avatar with speaker initial -->
                          <div class="avatar avatar-{{ loop.index }}" style="background: #004225; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem;">
                            {{ speaker[:1] if speaker else '?' }}
                          </div>
                        {% endif %}
                      </div>
                    {% endfor %}
                  {% endif %}
                </div>
                <span class="participant-count">{{ session.participant_count }} {{ session.participant_label }}{{ 's' if session.participant_count > 1 else '' }}</span>
              </div>
            {% endif %}
            {# NEW: afficher les tags de langue en ligne si présents #}
            {% if session.language and session.language|length > 0 %}
              <div class="language-tags">
                {% for lang in session.language %}
                  <span class="language-tag">{{ lang }}</span>
                {% endfor %}
              </div>
            {% endif %}
            <div class="session-duration">{{ session.duration }} min</div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Footer -->
    <div class="schedule-footer">
      <p>
        Rejoignez-nous pour célébrer Python et construire la communauté tech au Togo !
      </p>
    </div>

    <!-- Session Details Modal -->
    <div id="session-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-title"></h2>
          <button class="modal-close" aria-label="Close modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="session-time-info">
            <div class="time-slot">
              <span class="time-label">Horaire:</span>
              <span id="modal-time"></span>
            </div>
            <div class="duration-info">
              <span class="duration-label">Durée:</span>
              <span id="modal-duration"></span>
            </div>
            <div class="language-info">
              <span class="language-label">Langue(s):</span>
              <span id="modal-language" class="modal-language"></span>
            </div>
          </div>
          
          <div id="modal-subtitle" class="session-subtitle-modal"></div>
          
          <div class="session-description-full">
            <h4>À propos de cette session</h4>
            <div id="modal-description"></div>
          </div>
          
          <div id="modal-speakers" class="speakers-section"></div>
        </div>
      </div>
    </div>

    <!-- Hidden session data for JavaScript -->
    <script type="application/json" id="session-data">
      {{ schedule | tojson | safe }}
    </script>
  </div>
</section>
{% endblock %}
